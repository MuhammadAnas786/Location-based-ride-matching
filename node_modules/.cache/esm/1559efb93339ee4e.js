_333‍.x([["WriteToFile",()=>WriteToFile]]);const asyncLock = require("async-lock");
const fs = require("fs");

let lock = new asyncLock();

const getFile = async (FILE) => {
  try {
    const records = require(`./${FILE}`)
    return records;
  } catch (err) {
    console.log(err);
    return null;
  }
};
const getFormattedFile = async (FILE) => {
  let records = await getFile();
  if (!records) return null;
  let ar = [];
  for (const property in records) {
    ar.push(records[property]);
  }
  return ar;
};
const Validate = async (property, data) => {
  if (!data[property]) return false;
  let formatttedRecord = await getFormattedFile();
  return formatttedRecord.filter(
    (obj) => obj[property] === data[property] && obj.id != data.id
  );
};
const FileLock = function (callback) {
  return new Promise((resolve, reject) => {
    lock.acquire("WriteToFile", callback(resolve, reject));
  });
};
       const WriteToFile = async (data, FILE) => {

    try {
      console.log(data)
      fs.writeFileSync(FILE, JSON.stringify(data),'utf8',(err,data) =>{
        if(err)
        {console.log(err)
          throw err
        }
        else 
        console.log("Done!")
    });
      
    } catch (err) {
      throw err
    }
 
};

module.exports = {
  getFormattedFile,
  Validate,
  FileLock,
  getFile,
};
